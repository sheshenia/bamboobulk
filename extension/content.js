(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();let u,l,d,k,m,c,h;const S=()=>u&&l&&d,P=t=>{var e,n;return!!((n=(e=u[t])==null?void 0:e.clockEntries)!=null&&n.length)},_=t=>new Date(t).getDate()<=k,b=()=>h==="future"&&m,E=()=>h==="pending"&&m,L=()=>{const t=/CSRF_TOKEN\s*=\s*"([^"]+)"/im,e=document.scripts;for(let n=0;n<e.length;n++){const s=e[n].text;if(!s)continue;const i=s.match(t);if(i!=null&&i.length)return i[1]}},j=()=>{var n;const t=document.getElementById("js-timesheet-data");if(!t)return;const e=JSON.parse(t.textContent);console.log(e),c=e==null?void 0:e.timesheet,h=c==null?void 0:c.status,m=!!(c!=null&&c.canEdit),u=c==null?void 0:c.dailyDetails,l=e==null?void 0:e.employeeId,d=L(),console.log("CSRF_TOKEN: ",d),k=new Date(((n=e==null?void 0:e.today)==null?void 0:n.date)??Date.now()).getDate(),console.log(k)},F=[{trackingId:1,start:"09:00",end:"13:00",id:null,note:"",projectId:null,taskId:null},{trackingId:2,start:"14:00",end:"18:00",id:null,note:"",projectId:null,taskId:null}],O=(t,e)=>F.map(n=>({...n,employeeId:e,date:t})),T=(t,e,n,s=new Date(e).getDay())=>t.filter(o=>{var a;return(a=o.days)==null?void 0:a.includes(s)}).map((o,a)=>{let{start:r,end:p}=o;return r==="24:00"&&(r="00:00"),p==="00:00"&&(p="24:00"),{id:null,trackingId:a+1,employeeId:n,date:e,start:r,end:p,note:"",projectId:null,taskId:null}}),I=()=>`https://${location.hostname}/timesheet/clock/entries`,v=async(t,e)=>{await fetch(I(),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Csrf-Token":t},body:JSON.stringify({entries:e})})},A=async(t,e)=>{await fetch(I(),{method:"DELETE",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Csrf-Token":t},body:JSON.stringify({entries:e})})},D={skipWeekends:!0,skipHolidays:!0,skipTimeOffs:!0},W=t=>new Promise(e=>setTimeout(e,t)),C=t=>t<10?"0"+t:t,K=(t,e)=>{var n;return t.skipHolidays&&!!((n=e.holidays)!=null&&n.length)},q=(t,e)=>{var n;return t.skipTimeOffs&&!!((n=e.timeOff)!=null&&n.length)},H=(t,e)=>{if(!e.date)return!0;const s=new Date(e.date).getDay();return t.skipWeekends&&(s===6||s===0)},B=(t,e)=>e?(t||(t=D),K(t,e)||q(t,e)||H(t,e)):!0,y="clockEntries",g="bamboobulkConfigs",N=async()=>{const t=await chrome.storage.local.get(y);return window.__DEBUG__&&console.log("clockEntries from storage: ",t==null?void 0:t[y]),t==null?void 0:t[y]},x=async()=>{const t=await chrome.storage.local.get(g);return window.__DEBUG__&&console.log("Configs from storage:",t==null?void 0:t[g]),t==null?void 0:t[g]},R=t=>{const e=document.createElement("div");return e.className="one_day_del_btn",e.title="Delete clock entries",e.textContent="❌",e.onclick=async n=>{var i,o;n.stopPropagation();const s=(o=(i=u[t])==null?void 0:i.clockEntries)==null?void 0:o.map(a=>a.id);s!=null&&s.length&&(await A(d,s),location.reload())},e},$=async t=>{const e=await N();let n=[];e!=null&&e.length&&(n=T(e,t,l)),n.length||(n=O(t,l)),await v(d,n),location.reload()},M=t=>{const e=document.createElement("div");return e.className="one_day_add_btn",e.title="Add clock entries",e.textContent="🕔",e.onclick=()=>$(t),e},U=async()=>{if(!b()&&!E())return;let t=await x();t||(t=D),document.querySelectorAll(".TimesheetSlat").forEach(e=>{const n=e.querySelector(".TimesheetSlat__dayDate");if(n)try{const s=new Date().getFullYear(),i=new Date(n.textContent+" "+s),o=`${s}-${C(i.getMonth()+1)}-${C(i.getDate())}`;if(!(E()||_(o)))return;const r=u[o];if(!r||B(t,r))return;e.appendChild(P(o)?R(o):M(o))}catch(s){console.log(s)}})},G=async()=>{var i;if(!S()||!b()&&!E())return;document.getElementById("bamboobulk_btn").replaceWith(X());const e=document.getElementById("processed_day"),n=await N();console.log("storageEntries:",n);let s=await x();s||(s=D);for(const o of Object.values(u)){if(!o.date||(e.textContent=o.date,B(s,o))||b()&&!_(o.date)||(i=o==null?void 0:o.clockEntries)!=null&&i.length)continue;const a=n!=null&&n.length?T(n,o.date,l):O(o.date,l);a.length&&(console.log(a),await v(d,a),await W(500),console.log(o.date))}location.reload()},X=()=>{const t=document.createElement("div");return t.className="processing_div",t.innerHTML='<div class="loader"></div>Processing<div id="processed_day"></div>',t},Y=()=>{const t=document.createElement("button");return t.type="button",t.id="bamboobulk_btn",t.className="bamboobulk_btn",t.textContent="Bulk Time Entries",t.addEventListener("click",G),t},Z=()=>{const t=document.createElement("div");return t.id="bamboo-bulk-btn-container",t.className="bamboo-bulk-btn-container",t.appendChild(Y()),t},f=document.querySelector(".TimesheetEntries");var w;f&&(j(),S()&&m&&((((w=f.nextSibling)==null?void 0:w.firstChild)??f.nextSibling??f).prepend(Z()),U()));
