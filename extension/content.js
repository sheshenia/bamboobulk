(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();let u,l,d,k,m,c,h;const w=()=>u&&l&&d,x=e=>{var t,n;return!!((n=(t=u[e])==null?void 0:t.clockEntries)!=null&&n.length)},_=e=>new Date(e).getDate()<=k,b=()=>h==="future"&&m,E=()=>h==="pending"&&m,L=()=>{const e=/CSRF_TOKEN\s*=\s*"([^"]+)"/im,t=document.scripts;for(let n=0;n<t.length;n++){const i=t[n].text;if(!i)continue;const s=i.match(e);if(s!=null&&s.length)return s[1]}},A=()=>{var n;const e=document.getElementById("js-timesheet-data");if(!e)return;const t=JSON.parse(e.textContent);console.log(t),c=t==null?void 0:t.timesheet,h=c==null?void 0:c.status,m=!!(c!=null&&c.canEdit),u=c==null?void 0:c.dailyDetails,l=t==null?void 0:t.employeeId,d=L(),console.log("CSRF_TOKEN: ",d),k=new Date(((n=t==null?void 0:t.today)==null?void 0:n.date)??Date.now()).getDate(),console.log(k)},j=[{trackingId:1,start:"09:00",end:"13:00",id:null,note:"",projectId:null,taskId:null},{trackingId:2,start:"14:00",end:"18:00",id:null,note:"",projectId:null,taskId:null}],O=(e,t)=>j.map(n=>({...n,employeeId:t,date:e})),T=(e,t,n,i=new Date(t).getDay())=>e.filter(o=>{var a;return(a=o.days)==null?void 0:a.includes(i)}).map((o,a)=>{let{start:r,end:p}=o;return r==="24:00"&&(r="00:00"),p==="00:00"&&(p="24:00"),{id:null,trackingId:a+1,employeeId:n,date:t,start:r,end:p,note:"",projectId:null,taskId:null}}),I=()=>`https://${location.hostname}/timesheet/clock/entries`,v=async(e,t)=>{await fetch(I(),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Csrf-Token":e},body:JSON.stringify({entries:t})})},F=async(e,t)=>{await fetch(I(),{method:"DELETE",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Csrf-Token":e},body:JSON.stringify({entries:t})})},D={skipWeekends:!0,skipHolidays:!0,skipTimeOffs:!0},W=e=>new Promise(t=>setTimeout(t,e)),C=e=>e<10?"0"+e:e,K=(e,t)=>{var n;return e.skipHolidays&&!!((n=t.holidays)!=null&&n.length)},q=(e,t)=>{var n;return e.skipTimeOffs&&!!((n=t.timeOff)!=null&&n.length)},H=(e,t)=>{if(!t.date)return!0;const i=new Date(t.date).getDay();return e.skipWeekends&&(i===6||i===0)},B=(e,t)=>t?(e||(e=D),K(e,t)||q(e,t)||H(e,t)):!0,g="clockEntries",y="bamboobulkConfigs",N=async()=>{const e=await chrome.storage.local.get(g);return window.__DEBUG__&&console.log("clockEntries from storage: ",e==null?void 0:e[g]),e==null?void 0:e[g]},P=async()=>{const e=await chrome.storage.local.get(y);return window.__DEBUG__&&console.log("Configs from storage:",e==null?void 0:e[y]),e==null?void 0:e[y]},R=e=>{const t=document.createElement("div");return t.className="one_day_del_btn",t.title="Delete clock entries",t.textContent="❌",t.onclick=async n=>{var s,o;n.stopPropagation();const i=(o=(s=u[e])==null?void 0:s.clockEntries)==null?void 0:o.map(a=>a.id);i!=null&&i.length&&(await F(d,i),location.reload())},t},$=async e=>{const t=await N();let n=[];t!=null&&t.length&&(n=T(t,e,l)),n.length||(n=O(e,l)),await v(d,n),location.reload()},M=e=>{const t=document.createElement("div");return t.className="one_day_add_btn",t.title="Add clock entries",t.textContent="🕔",t.onclick=()=>$(e),t},U=async()=>{if(!b()&&!E())return;let e=await P();e||(e=D),document.querySelectorAll(".TimesheetSlat").forEach(t=>{const n=t.querySelector(".TimesheetSlat__dayDate");if(n)try{const i=new Date().getFullYear(),s=new Date(n.textContent+" "+i),o=`${i}-${C(s.getMonth()+1)}-${C(s.getDate())}`;if(!(E()||_(o)))return;const r=u[o];if(!r||B(e,r))return;t.appendChild(x(o)?R(o):M(o))}catch(i){console.log(i)}})},G=async()=>{var s;if(!w()||!b()&&!E())return;document.getElementById("bamboobulk_btn").replaceWith(X());const t=document.getElementById("processed_day"),n=await N();console.log("storageEntries:",n);let i=await P();i||(i=D);for(const o of Object.values(u)){if(!o.date||(t.textContent=o.date,B(i,o))||b()&&!_(o.date)||(s=o==null?void 0:o.clockEntries)!=null&&s.length)continue;const a=n!=null&&n.length?T(n,o.date,l):O(o.date,l);a.length&&(console.log(a),await v(d,a),await W(500),console.log(o.date))}location.reload()},X=()=>{const e=document.createElement("div");return e.className="processing_div",e.innerHTML='<div class="loader"></div>Processing<div id="processed_day"></div>',e},Y=()=>{const e=document.createElement("button");return e.type="button",e.id="bamboobulk_btn",e.className="bamboobulk_btn",e.textContent="Bulk Time Entries",e.addEventListener("click",G),e},Z=()=>{const e=document.createElement("div");return e.id="bamboo-bulk-btn-container",e.className="bamboo-bulk-btn-container",e.appendChild(Y()),e},f=document.querySelector(".TimesheetEntries");var S;f&&(console.log("start parseTimeSheetAndPopulateData()"),A(),w()&&m&&(console.log("parseTimeSheetAndPopulateData() parsed ok!"),(((S=f.nextSibling)==null?void 0:S.firstChild)??f.nextSibling??f).prepend(Z()),U()));
