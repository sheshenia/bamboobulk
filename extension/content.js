(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();let u,l,d,g,f,c,E;const w=()=>u&&l&&d,P=e=>{var t,n;return!!((n=(t=u[e])==null?void 0:t.clockEntries)!=null&&n.length)},_=e=>new Date(e).getDate()<=g,b=()=>E==="future"&&f,k=()=>E==="pending"&&f,x=()=>{const e=/CSRF_TOKEN\s*=\s*"([^"]+)"/im,t=document.scripts;for(let n=0;n<t.length;n++){const i=t[n].text;if(!i)continue;const s=i.match(e);if(s!=null&&s.length)return s[1]}},L=()=>{var n;const e=document.getElementById("js-timesheet-data");if(!e)return;const t=JSON.parse(e.textContent);console.log(t),c=t==null?void 0:t.timesheet,E=c==null?void 0:c.status,f=!!(c!=null&&c.canEdit),u=c==null?void 0:c.dailyDetails,l=t==null?void 0:t.employeeId,d=x(),console.log("CSRF_TOKEN: ",d),g=new Date(((n=t==null?void 0:t.today)==null?void 0:n.date)??Date.now()).getDate(),console.log(g)},j=[{trackingId:1,start:"09:00",end:"13:00",id:null,note:"",projectId:null,taskId:null},{trackingId:2,start:"14:00",end:"18:00",id:null,note:"",projectId:null,taskId:null}],O=(e,t)=>j.map(n=>({...n,employeeId:t,date:e})),S=(e,t,n,i=new Date(t).getDay())=>e.filter(o=>{var a;return(a=o.days)==null?void 0:a.includes(i)}).map((o,a)=>{let{start:r,end:m}=o;return r==="24:00"&&(r="00:00"),m==="00:00"&&(m="24:00"),{id:null,trackingId:a+1,employeeId:n,date:t,start:r,end:m,note:"",projectId:null,taskId:null}}),T="https://ninjaone.bamboohr.com/timesheet/clock/entries",v=async(e,t)=>{await fetch(T,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Csrf-Token":e},body:JSON.stringify({entries:t})})},F=async(e,t)=>{await fetch(T,{method:"DELETE",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Csrf-Token":e},body:JSON.stringify({entries:t})})},h={skipWeekends:!0,skipHolidays:!0,skipTimeOffs:!0},W=e=>new Promise(t=>setTimeout(t,e)),D=e=>e<10?"0"+e:e,K=(e,t)=>{var n;return e.skipHolidays&&!!((n=t.holidays)!=null&&n.length)},q=(e,t)=>{var n;return e.skipTimeOffs&&!!((n=t.timeOff)!=null&&n.length)},A=(e,t)=>{if(!t.date)return!0;const i=new Date(t.date).getDay();return e.skipWeekends&&(i===6||i===0)},I=(e,t)=>t?(e||(e=h),K(e,t)||q(e,t)||A(e,t)):!0,y="clockEntries",p="bamboobulkConfigs",B=async()=>{const e=await chrome.storage.local.get(y);return window.__DEBUG__&&console.log("clockEntries from storage: ",e==null?void 0:e[y]),e==null?void 0:e[y]},N=async()=>{const e=await chrome.storage.local.get(p);return window.__DEBUG__&&console.log("Configs from storage:",e==null?void 0:e[p]),e==null?void 0:e[p]},H=e=>{const t=document.createElement("div");return t.className="one_day_del_btn",t.title="Delete clock entries",t.textContent="❌",t.onclick=async n=>{var s,o;n.stopPropagation();const i=(o=(s=u[e])==null?void 0:s.clockEntries)==null?void 0:o.map(a=>a.id);i!=null&&i.length&&(await F(d,i),location.reload())},t},R=async e=>{const t=await B();let n=[];t!=null&&t.length&&(n=S(t,e,l)),n.length||(n=O(e,l)),await v(d,n),location.reload()},M=e=>{const t=document.createElement("div");return t.className="one_day_add_btn",t.title="Add clock entries",t.textContent="🕔",t.onclick=()=>R(e),t},U=async()=>{if(!b()&&!k())return;let e=await N();e||(e=h),document.querySelectorAll(".TimesheetSlat").forEach(t=>{const n=t.querySelector(".TimesheetSlat__dayDate");if(n)try{const i=new Date().getFullYear(),s=new Date(n.textContent+" "+i),o=`${i}-${D(s.getMonth()+1)}-${D(s.getDate())}`;if(!(k()||_(o)))return;const r=u[o];if(!r||I(e,r))return;t.appendChild(P(o)?H(o):M(o))}catch(i){console.log(i)}})},$=async()=>{var s;if(!w()||!b()&&!k())return;document.getElementById("bamboobulk_btn").replaceWith(G());const t=document.getElementById("processed_day"),n=await B();console.log("storageEntries:",n);let i=await N();i||(i=h);for(const o of Object.values(u)){if(!o.date||(t.textContent=o.date,I(i,o))||b()&&!_(o.date)||(s=o==null?void 0:o.clockEntries)!=null&&s.length)continue;const a=n!=null&&n.length?S(n,o.date,l):O(o.date,l);a.length&&(console.log(a),await v(d,a),await W(500),console.log(o.date))}location.reload()},G=()=>{const e=document.createElement("div");return e.className="processing_div",e.innerHTML='<div class="loader"></div>Processing<div id="processed_day"></div>',e},X=()=>{const e=document.createElement("button");return e.type="button",e.id="bamboobulk_btn",e.className="bamboobulk_btn",e.textContent="Bulk Time Entries",e.addEventListener("click",$),e},Y=()=>{const e=document.createElement("div");return e.id="bamboo-bulk-btn-container",e.className="bamboo-bulk-btn-container",e.appendChild(X()),e},C=document.querySelector(".TimesheetSummaryContainer");C&&(L(),w()&&f&&(C.prepend(Y()),U()));
