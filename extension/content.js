(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();let u,l,d,g,f,c,E;const w=()=>u&&l&&d,P=t=>{var e,n;return!!((n=(e=u[t])==null?void 0:e.clockEntries)!=null&&n.length)},_=t=>new Date(t).getDate()<=g,k=()=>E==="future"&&f,b=()=>E==="pending"&&f,x=()=>{const t=/CSRF_TOKEN\s*=\s*"([^"]+)"/im,e=document.scripts;for(let n=0;n<e.length;n++){const i=e[n].text;if(!i)continue;const s=i.match(t);if(s!=null&&s.length)return s[1]}},L=()=>{var n;const t=document.getElementById("js-timesheet-data");if(!t)return;const e=JSON.parse(t.textContent);console.log(e),c=e==null?void 0:e.timesheet,E=c==null?void 0:c.status,f=!!(c!=null&&c.canEdit),u=c==null?void 0:c.dailyDetails,l=e==null?void 0:e.employeeId,d=x(),console.log("CSRF_TOKEN: ",d),g=new Date(((n=e==null?void 0:e.today)==null?void 0:n.date)??Date.now()).getDate(),console.log(g)},j=[{trackingId:1,start:"09:00",end:"13:00",id:null,note:"",projectId:null,taskId:null},{trackingId:2,start:"14:00",end:"18:00",id:null,note:"",projectId:null,taskId:null}],O=(t,e)=>j.map(n=>({...n,employeeId:e,date:t})),S=(t,e,n,i=new Date(e).getDay())=>t.filter(o=>{var a;return(a=o.days)==null?void 0:a.includes(i)}).map((o,a)=>{let{start:r,end:m}=o;return r==="24:00"&&(r="00:00"),m==="00:00"&&(m="24:00"),{id:null,trackingId:a+1,employeeId:n,date:e,start:r,end:m,note:"",projectId:null,taskId:null}}),T=()=>`https://${location.hostname}/timesheet/clock/entries`,v=async(t,e)=>{await fetch(T(),{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Csrf-Token":t},body:JSON.stringify({entries:e})})},F=async(t,e)=>{await fetch(T(),{method:"DELETE",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Csrf-Token":t},body:JSON.stringify({entries:e})})},h={skipWeekends:!0,skipHolidays:!0,skipTimeOffs:!0},W=t=>new Promise(e=>setTimeout(e,t)),D=t=>t<10?"0"+t:t,K=(t,e)=>{var n;return t.skipHolidays&&!!((n=e.holidays)!=null&&n.length)},q=(t,e)=>{var n;return t.skipTimeOffs&&!!((n=e.timeOff)!=null&&n.length)},A=(t,e)=>{if(!e.date)return!0;const i=new Date(e.date).getDay();return t.skipWeekends&&(i===6||i===0)},I=(t,e)=>e?(t||(t=h),K(t,e)||q(t,e)||A(t,e)):!0,y="clockEntries",p="bamboobulkConfigs",B=async()=>{const t=await chrome.storage.local.get(y);return window.__DEBUG__&&console.log("clockEntries from storage: ",t==null?void 0:t[y]),t==null?void 0:t[y]},N=async()=>{const t=await chrome.storage.local.get(p);return window.__DEBUG__&&console.log("Configs from storage:",t==null?void 0:t[p]),t==null?void 0:t[p]},H=t=>{const e=document.createElement("div");return e.className="one_day_del_btn",e.title="Delete clock entries",e.textContent="❌",e.onclick=async n=>{var s,o;n.stopPropagation();const i=(o=(s=u[t])==null?void 0:s.clockEntries)==null?void 0:o.map(a=>a.id);i!=null&&i.length&&(await F(d,i),location.reload())},e},R=async t=>{const e=await B();let n=[];e!=null&&e.length&&(n=S(e,t,l)),n.length||(n=O(t,l)),await v(d,n),location.reload()},$=t=>{const e=document.createElement("div");return e.className="one_day_add_btn",e.title="Add clock entries",e.textContent="🕔",e.onclick=()=>R(t),e},M=async()=>{if(!k()&&!b())return;let t=await N();t||(t=h),document.querySelectorAll(".TimesheetSlat").forEach(e=>{const n=e.querySelector(".TimesheetSlat__dayDate");if(n)try{const i=new Date().getFullYear(),s=new Date(n.textContent+" "+i),o=`${i}-${D(s.getMonth()+1)}-${D(s.getDate())}`;if(!(b()||_(o)))return;const r=u[o];if(!r||I(t,r))return;e.appendChild(P(o)?H(o):$(o))}catch(i){console.log(i)}})},U=async()=>{var s;if(!w()||!k()&&!b())return;document.getElementById("bamboobulk_btn").replaceWith(G());const e=document.getElementById("processed_day"),n=await B();console.log("storageEntries:",n);let i=await N();i||(i=h);for(const o of Object.values(u)){if(!o.date||(e.textContent=o.date,I(i,o))||k()&&!_(o.date)||(s=o==null?void 0:o.clockEntries)!=null&&s.length)continue;const a=n!=null&&n.length?S(n,o.date,l):O(o.date,l);a.length&&(console.log(a),await v(d,a),await W(500),console.log(o.date))}location.reload()},G=()=>{const t=document.createElement("div");return t.className="processing_div",t.innerHTML='<div class="loader"></div>Processing<div id="processed_day"></div>',t},X=()=>{const t=document.createElement("button");return t.type="button",t.id="bamboobulk_btn",t.className="bamboobulk_btn",t.textContent="Bulk Time Entries",t.addEventListener("click",U),t},Y=()=>{const t=document.createElement("div");return t.id="bamboo-bulk-btn-container",t.className="bamboo-bulk-btn-container",t.appendChild(X()),t},C=document.querySelector(".TimesheetSummaryContainer");C&&(L(),w()&&f&&(C.prepend(Y()),M()));
