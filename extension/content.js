(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();let u,l,d,m;const E=()=>u&&l&&d,_=e=>u.hasOwnProperty(e),O=e=>{var t,o;return!!((o=(t=u[e])==null?void 0:t.clockEntries)!=null&&o.length)},S=e=>new Date(e).getDate()<=m,B=()=>{const e=/CSRF_TOKEN\s*=\s*"([^"]+)"/im,t=document.scripts;for(let o=0;o<t.length;o++){const s=t[o].text;if(!s)continue;const n=s.match(e);if(n!=null&&n.length)return n[1]}},I=()=>{var o,s;const e=document.getElementById("js-timesheet-data");if(!e)return;const t=JSON.parse(e.textContent);console.log(t),u=(o=t==null?void 0:t.timesheet)==null?void 0:o.dailyDetails,l=t==null?void 0:t.employeeId,d=B(),console.log("CSRF_TOKEN: ",d),m=new Date(((s=t==null?void 0:t.today)==null?void 0:s.date)??Date.now()).getDate(),console.log(m)},v=[{trackingId:1,start:"09:00",end:"13:00",id:null,note:"",projectId:null,taskId:null},{trackingId:2,start:"14:00",end:"18:00",id:null,note:"",projectId:null,taskId:null}],D=(e,t)=>v.map(o=>({...o,employeeId:t,date:e})),y=(e,t,o,s=new Date(t).getDay())=>{const n=e.filter(c=>{var i;return(i=c.days)==null?void 0:i.includes(s)}).map((c,i)=>{let{start:a,end:r}=c;return a==="24:00"&&(a="00:00"),r==="00:00"&&(r="24:00"),{id:null,trackingId:i+1,employeeId:o,date:t,start:a,end:r,note:"",projectId:null,taskId:null}});return n.length>0?n:y(t,o)},C="https://ninjaone.bamboohr.com/timesheet/clock/entries",w=async(e,t)=>{await fetch(C,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Csrf-Token":e},body:JSON.stringify({entries:t})})},N=async(e,t)=>{await fetch(C,{method:"DELETE",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Csrf-Token":e},body:JSON.stringify({entries:t})})},P=e=>new Promise(t=>setTimeout(t,e)),k=e=>e<10?"0"+e:e,g="clockEntries",p="bamboobulkConfigs",T=async()=>{const e=await chrome.storage.local.get(g);return window.__DEBUG__&&console.log("clockEntries from storage: ",e==null?void 0:e[g]),e==null?void 0:e[g]},x=async()=>{const e=await chrome.storage.local.get(p);return window.__DEBUG__&&console.log("Configs from storage:",e==null?void 0:e[p]),e==null?void 0:e[p]},L=e=>{const t=document.createElement("div");return t.className="one_day_del_btn",t.title="Delete clock entries",t.textContent="âŒ",t.onclick=async o=>{var n,c;o.stopPropagation();const s=(c=(n=u[e])==null?void 0:n.clockEntries)==null?void 0:c.map(i=>i.id);s!=null&&s.length&&(await N(d,s),location.reload())},t},j=async e=>{console.log("Add:",e);const t=await T(),o=t!=null&&t.length?y(t,e,l):D(e,l);await w(d,o),location.reload()},F=e=>{const t=document.createElement("div");return t.className="one_day_add_btn",t.title="Add clock entries",t.textContent="ðŸ•”",t.onclick=()=>j(e),t},A=()=>{document.querySelectorAll(".TimesheetSlat").forEach(e=>{const t=e.querySelector(".TimesheetSlat__dayDate");if(t)try{const o=new Date().getFullYear(),s=new Date(t.textContent+" "+o),n=`${o}-${k(s.getMonth()+1)}-${k(s.getDate())}`;_(n)&&S(n)&&(console.log("adding delBtn to:",t.textContent,"dateData:",n),e.appendChild(O(n)?L(n):F(n)))}catch(o){console.log(o)}})},K={skipWeekends:!0,skipHolidays:!0,skipTimeOffs:!0},W=async()=>{var n,c,i;if(!E())return;document.getElementById("bamboobulk_btn").replaceWith(q());const t=document.getElementById("processed_day"),o=await T();console.log("storageEntries:",o);let s=await x();s||(s=K);for(const a of Object.values(u)){if(!a.date||(t.textContent=a.date,s.skipHolidays&&((n=a==null?void 0:a.holidays)!=null&&n.length))||s.skipTimeOffs&&((c=a==null?void 0:a.timeOff)!=null&&c.length))continue;const r=new Date(a.date),f=r.getDay();if(s.skipWeekends&&(f===6||f===0)||r.getDate()>m||(i=a==null?void 0:a.clockEntries)!=null&&i.length)continue;const b=o!=null&&o.length?y(o,a.date,l,f):D(a.date,l);console.log(b),await w(d,b),await P(500),console.log(a.date)}location.reload()},q=()=>{const e=document.createElement("div");return e.className="processing_div",e.innerHTML='<div class="loader"></div>Processing<div id="processed_day"></div>',e},R=()=>{const e=document.createElement("button");return e.type="button",e.id="bamboobulk_btn",e.className="bamboobulk_btn",e.textContent="Bulk Time Entries",e.addEventListener("click",W),e},H=()=>{const e=document.createElement("div");return e.id="bamboo-bulk-btn-container",e.className="bamboo-bulk-btn-container",e.appendChild(R()),e},h=document.querySelector(".TimesheetSummaryContainer");h&&(I(),E()&&(h.prepend(H()),A()));
